<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <style>* { padding: 0; margin: 0; }</style>
        <script src="js/phaser.min.js"></script>
    </head>
    <body>
        <script>
            var game = new Phaser.Game(480, 320, Phaser.AUTO, null, {preload: preload, create: create, update: update});
            var ball;
            var paddle1, paddle2;
            var cursors;
            var left, right;
            var bricks, newBrick, brickInfo;
            
            //preload sets up the canvas...load resources and images
            function preload() {
                // Loading the Phaser Modules for the canvas
                game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
                
                // Setting the Canvas Properties
                game.scale.pageAlignHorizontally = true;
                game.scale.pageAlignVertically = true;
                
                // Setting the Background for the Program
                game.stage.backgroundColor = '#2f0601';
                
                // Loading the Ball Element
                game.load.image('ball', 'img/ball.png');
                // Loading the Paddles
                game.load.image('paddle1', 'img/paddle.png');
                game.load.image('paddle2', 'img/paddle.png');
                game.load.image('brick', 'img/brick.png');

            }

            //Create Interactable resouces for the program
            function create() {
                // Adding Phhysics within the Canvas
                game.physics.startSystem(Phaser.Physics.ARCADE);

                // Creating the Ball Element with the canvas
                ball = game.add.sprite(game.world.width*0.5, game.world.height-25, 'ball');
                ball.anchor.set(0.5);

                // Enabling Physics on the Ball Element
                game.physics.enable(ball, Phaser.Physics.ARCADE);

                // Setting Losing Parameters
                game.physics.arcade.checkCollision.down = false;
                game.physics.arcade.checkCollision.up = false;

                // Boundry of the canvas is set as Wall with Bounce physics enabled
                ball.body.collideWorldBounds = true;
                ball.body.bounce.set(1);

                // Checking the Game End Parameters
                ball.checkWorldBounds = true;
                ball.events.onOutOfBounds.add(function(){ alert('Game over!');location.reload();}, game);
                
                // Setting the Traversal Parameters for the Ball
                ball.body.velocity.set(100,-100);


                // Adding Cursor Keys within the Program
                    // Paddle 1 controls
                    cursors = this.input.keyboard.createCursorKeys();
                    // Paddle 2 controls
                    this.left = this.input.keyboard.addKey(Phaser.Keyboard.A);
                    this.right = this.input.keyboard.addKey(Phaser.Keyboard.D);
                
                
                paddle1 = game.add.sprite(game.world.width*(0.5), game.world.height*(0.98), 'paddle1');
                paddle1.anchor.set(0.5,1);
                game.physics.enable(paddle1, Phaser.Physics.ARCADE);
                paddle1.body.immovable = true;


                paddle2 = game.add.sprite(game.world.width*(0.5), game.world.height*(0.05), 'paddle2');
                paddle2.anchor.set(0.5,1);
                game.physics.enable(paddle2, Phaser.Physics.ARCADE);
                paddle2.body.immovable = true;
            
                initbricks();
                 

            }


            function update() {
                // Paddle 1 Controls
                if(cursors.left.isDown)
                    paddle1.body.velocity.set(-150,0);
                else if(cursors.right.isDown)
                    paddle1.body.velocity.set(150,0);
                else
                    paddle1.body.velocity.set(0,0);
                game.physics.arcade.collide(ball, paddle1);
                
                // Paddle 2 Controls
                if(this.left.isDown)
                    paddle2.body.velocity.set(-150,0);
                else if(this.right.isDown)
                    paddle2.body.velocity.set(150,0);
                else
                    paddle2.body.velocity.set(0,0);
                game.physics.arcade.collide(ball, paddle2);
            }

            function initbricks() {
                brickInfo = {
                    width: 50,
                    height: 20,
                    count: {
                        row: 3,
                        col: 7
                    },
                    offset: {
                        top: 120,
                        left: 60
                    },
                    padding: 10
                };

                bricks = game.add.group();
                for(c=0; c<brickInfo.count.col; c+=2) {
                    for(r=0; r<brickInfo.count.row; r+=2) {
                        var brickX = (c*(brickInfo.width+brickInfo.padding))+brickInfo.offset.left;
                        var brickY = (r*(brickInfo.height+brickInfo.padding))+brickInfo.offset.top;
                        newBrick = game.add.sprite(brickX, brickY, 'brick');
                        game.physics.enable(newBrick, Phaser.Physics.ARCADE);
                        newBrick.body.immovable = true;
                        newBrick.anchor.set(0.5);
                        bricks.add(newBrick);
                    }
                }
            }

        </script>   
    </body>
</html>